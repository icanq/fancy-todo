<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google-signin-client_id" content="135754795964-jgcilhhb0p1j7cttojsh8oi5vaoa87cc.apps.googleusercontent.com">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <title>fancy~todo</title>
  </head>
  <body>
    
    <!-- login-page -->
    <div id="login-page" class="login-page">
      <div class="jumbotron">
        <div class="container d-flex justify-content-center">
          <!-- Sign In Form -->
          <div class="w-100 d-flex justify-content-center align-items-center">
            <div class="card shadow mb-5">
              <form class="card-body" id="login-form">
                <div class="form-group mb-4">
                  <h2>Login</h2>
                  <label for="login-email">Username or Email</label>
                  <input
                    type="text"
                    class="form-control"
                    id="login-email"
                    required
                  />
                </div>
                <div class="form-group mb-4">
                  <label for="password">Password</label>
                  <input
                    type="password"
                    class="form-control"
                    id="login-password"
                    required
                  />
                </div>
                <div class="d-inline-flex align-items-center">
                  <button type="submit" class="btn btn-primary">Sign In</button>
                  <span class="mx-3">Or</span>
                  <div
                    class="g-signin2 d-inline-block"
                    data-onsuccess="checkSession"
                  ></div>
                </div>
                <div class="text-right" >
                  <small>
                    <a href="" id="link-register">Don't have an account?</a
                    >
                  </small>
                </div>
              </form>
            </div>
          </div>
        </div>
          <!-- end login-page -->
        </div>
      </div>
    </div>

    <!-- register-page -->
    <!-- Sign Up Page -->
    <div class="page" id="register-page">
      <div class="jumbotron jumbotron-fluid">
        <div class="container d-flex justify-content-center">
          <!-- Sign Up Form -->
          <div class="w-100 d-flex justify-content-center align-items-center">
            <div class="card shadow mb-5">
              <form id="register-form" class="card-body">
                <h1>Sign Up</h1>
                <div class="form-group">
                  <label for="username">Username</label>
                  <input
                    type="text"
                    class="form-control"
                    id="register-username"
                    required
                  />
                  <small class="form-text text-muted"
                    >usernamenya yang keren dikit</small
                  >
                </div>
                <div class="form-group">
                  <label for="email">Email</label>
                  <input
                    type="email"
                    class="form-control"
                    id="register-email"
                    required
                  />
                  <small class="form-text text-muted"
                    >email yang bener</small
                  >
                </div>
                <div class="form-group">
                  <label for="password">Password</label>
                  <input
                    type="password"
                    class="form-control"
                    id="register-password"
                    required
                  />
                  <small class="form-text text-muted"
                    >Must at least have 6 characters length.</small
                  >
                </div>
                <div class="d-inline-flex align-items-center">
                  <button type="submit" class="btn btn-primary">Sign Up</button>
                  <span class="mx-3">Or</span>
                  <div
                    class="g-signin2 d-inline-block"
                    data-onsuccess="checkSession"
                  ></div>
                </div>
                <div href="" class="text-right">
                  <a href=""  id="link-login"><small>
                      >Already have account?</a
                    >
                  </small></a>
                </div>
              </form>
            </div>
          </div>
        </div>
        <!-- end register-page -->
        </div>
      </div>


    <!-- main-page -->
    <div id="main-page">
      <div id="create-todo-form">
        <form id="add-form">
          <div class="form-group">
            <label for="inputTittle">Tittle</label>
            <input type="text" id="inputTittle" class="form-control">
          </div>
          <div class="form-group">
            <label for="inputDescription">Description</label>
            <input type="text" id="inputDescription" class="form-control">
          </div>
          <div class="form-group">
            <label for="inputDuedate">Due date</label>
            <input type="date" id="inputDuedate" class="form-control">
          </div>
          <input type="submit" id="submit-add" value="add">
        </form>
      </div>
      <br>
      <div id="list-todo" class="row row-cols-1 row-cols-md-4"></div>

    </div>
    <div id="edit-page"></div>
  </div>
  <!-- end main-page -->
    
    <!-- SCRIPT SCRIPT -->
    <script src="./js/main.js"></script>
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    
    <!-- page handler -->
    <script>
      const URL = "http://localhost:3000/"
      //hidesemua
      function hideAll() {
        $('#login-page').hide()
        $('#register-page').hide()
        $('#main-page').hide()
        $('#create-todo').hide()
        $('#edit-page').hide()
      }

      //login
      function showLogin() {
        hideAll()
        $('#login-page').show()
      }

      function login() {
        const email = $('#login-email').val()
        const password = $('#login-password').val()
        $.ajax({
          method: 'POST',
          url: "http://localhost:3000/login",
          data: {
            email, password
          }
        })
        .done((response) => {
          localStorage.setItem('access_token', response.access_token)
          console.log(response.access_token)
          showMainPage()
        })
        .fail((xhr) => {
          console.log(xhr.responseJSON)
        })
        .always(_ => {
          $('#login-page').trigger('reset')
        })
      }


      //login google
      function onSignIn(googleUser) {
      var id_token = googleUser.getAuthResponse().id_token;
      console.log(id_token);
      $.ajax({
        url: 'http://localhost:3000/loginGoogle',
        method: 'POST',
        data: {
          googleToken: id_token
        }
      })
        .done(response => {
          localStorage.setItem('access_token', response.access_token)
          showMainPage();
        })
        .fail((xhr, textStatus) => {
          console.log(xhr, textStatus);
        })
    }
      // register
      function showRegister(e) {
        hideAll()
        $("#login-page").hide()
        $('#register-page').show()
      }

      function register() {
        const username = $('#register-username').val()
        const email = $('#register-email').val()
        const password = $('#register-password').val()

        $.ajax({
          method: 'POST',
          url: "http://localhost:3000/register",
          data: {
            username, email, password
          }
        })
        .done((response) => {
          showLogin()
        })
        .fail((xhr) => {
          console.log(xhr.responseJSON)
        })
        .always(_ => {
          $('#register-page').trigger('reset')
        })
      }
    
      // logout
      function logout() {
          e.preventDefault()
          var auth2 = gapi.auth2.getAuthInstance()
          auth2.signOut().then(function() {
            console.log('User signed out.')
          })
          localStorage.removeItem('access_token')
          // toast('Sign out success!', 3000)
          showLogin()
      }

      function showMainPage() {
        hideAll()
        $('#main-page').show()
      }
      $(document).ready(() => {
        if (localStorage.getItem("access_token")) {
          showMainPage()
        } else {
          showLogin()
        }
        //ketika hit submit form di login
        $('#login-form').on('submit', (e) => {
          e.preventDefault()
          login()
        })
        //redirect register ke login
        $('#link-login').on('click', (e) => {
          e.preventDefault();
          showLogin()
        })
        //redirect login ke register
        $('#link-register').on('click', (e) => {
          e.preventDefault();
          showRegister()
        })
        //hit submit form di register
        $('#register-form').on('submit', (e) => {
          e.preventDefault()
          register()
        })

      })
    </script>
    <!-- END SCRIPT SCRIPT -->
  </body>
</html>
